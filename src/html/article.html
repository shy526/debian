<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>文章</title>


    <!--MAIN STYLE-->
    <link href="../css/template/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="../css/template/main.css" rel="stylesheet" type="text/css">
    <link href="../css/template/style.css" rel="stylesheet" type="text/css">
    <link href="../css/template/responsive.css" rel="stylesheet" type="text/css">
    <link href="../css/template/animate.css" rel="stylesheet" type="text/css">
    <link href="../css/template/font-awesome.min.css" rel="stylesheet" type="text/css">
    <!-- ADD YOUR OWN STYLING HERE. AVOID TO USE STYLE.CSS AND MAIN.CSS. IT WILL BE HELPFUL FOR YOU IN FUTURE UPDATES -->
    <link href="../css/template/custom.css" rel="stylesheet" type="text/css">

    <!-- SLIDER REVOLUTION 4.x CSS SETTINGS -->
    <link rel="stylesheet" type="text/css" href="../js/template/rs-plugin/css/settings.css" media="screen"/>

    <!-- JavaScripts -->
    <script src="../js/template/modernizr.js"></script>


</head>
<body>
<!-- LOADER ===========================================-->
@@include('./loader.html',{

})

<!-- Page Wrap -->
<div id="wrap">

    <!-- Header -->
    <!-- Header -->
    @@include('./menu.html',{
    "article": "active"
    })
    <!-- Header End -->

    <!-- CONTENT START -->
    <div class="content">

        <!--======= SUB BANNER =========-->
        <section class="sub-banner">
            <div class="container">
                <h4>文章<span id="user-depot"></span></h4>
                <!-- Breadcrumb -->
                <ol class="breadcrumb">
                    <li><a href="/debian/index">主页</a></li>
                    <li class="active">文章</li>
                </ol>
            </div>
        </section>

        <!-- Blog -->
        <section class="section-p-30px blog-page">
            <div class="container">
                <div class="row">

                    <!-- Right Side Bar -->
                    <div class="col-sm-3 animate fadeInLeft" data-wow-delay="0.4s">
                        <div class="side-bar">

                            <!--  SEARCH -->
                            <div class="search">
                                <form>
                                    <input type="text" placeholder="检索" id="search-text">
                                    <button type="button"><i class="fa fa-search" id="search"></i></button>
                                </form>
                            </div>

                            <!-- HEADING -->
                            <div class="heading">
                                <h4>作者</h4>
                            </div>
                            <!-- CATEGORIES -->
                            <ul class="cate" id="user-depot-list">

                            </ul>

                            <!-- HEADING -->
                            <div class="heading">
                                <h4>分类</h4>
                            </div>

                            <!-- CATEGORIES -->
                            <ul class="cate" id="category-list">
                            </ul>

                            <!-- HEADING -->
                            <div class="heading">
                                <h4>最近更新</h4>
                            </div>
                            <!-- CATEGORIES -->
                            <ul class="cate latest-post" id="latest-post">

                            </ul>


                            <!-- TAGS -->
                            <h4 class="margin-t-40">标签(暂不支持)</h4>
                            <ul class="tags">
                                <li><a href="#.">hadoop</a></li>
                                <li><a href="#.">c</a></li>
                                <li><a href="#.">c++</a></li>
                                <li><a href="#.">java</a></li>
                                <li><a href="#.">mysql</a></li>
                                <li><a href="#.">web</a></li>
                            </ul>
                        </div>
                    </div>

                    <!-- Blog Bar -->
                    <div class="col-sm-9 animate fadeInRight" data-wow-delay="0.4s">
                        <!--  Blog Posts -->
                        <div class="blog-posts medium-images">
                            <ul id="markdown-list">
                                <!--  Posts 1 -->

                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- GO TO TOP -->
    <a href="#" class="cd-top"><i class="fa fa-angle-up"></i></a>
    <!-- GO TO TOP End -->
</div>
<!-- Wrap End -->
<script src="../js/template/jquery-1.11.3.js"></script>
<script src="../js/template/wow.min.js"></script>
<script src="../js/template/bootstrap.min.js"></script>
<script src="../js/template/own-menu.js"></script>
<script src="../js/template/owl.carousel.min.js"></script>
<script src="../js/template/jquery.magnific-popup.min.js"></script>
<script src="../js/template/jquery.isotope.min.js"></script>
<script src="../js/template/jquery.flexslider-min.js"></script>
<script src="../js/common/dateFormat.js"></script>

<!-- SLIDER REVOLUTION 4.x SCRIPTS  -->
<script type="text/javascript" src="../js/template/rs-plugin/js/jquery.themepunch.tools.min.js"></script>
<script type="text/javascript" src="../js/template/rs-plugin/js/jquery.themepunch.revolution.min.js"></script>
<script src="../js/template/main.js"></script>
<script>
    let author = {
        pageNumber: 1,
        pageSize: 5,
        end: false,
        ifEnd: function (array) {
            this.pageNumber++;
            if (array.length <= 0) {
                this.pageNumber = 1;
            }
        }
    }
    let id;

    function cutAuthor(item) {
        id = item.id
        $("#user-depot").text("(" + item.githubName + "/" + item.depot + ")")

    }

    function authorS(callback) {
        $.ajax({
            url: "/api/hook/list",
            data: {
                pageNumber: author.pageNumber,
                pageSize: author.pageSize
            },
            beforeSend: function () {

            },
            success: function (result) {
                if (result) {
                    if (result.code == 200) {
                        author.ifEnd(result.data);
                        if (result.data.length <= 0) {
                            alert("没有更多的数据了")
                            return;
                        }
                        $("#user-depot-list").empty();
                        result.data.forEach((item) => {
                            let html = "<li><a href=\"javascript:void(0)\">" + item.githubName + "/" + item.depot + "</a></li>"
                            $("#user-depot-list").append(html);
                        })
                        $("#user-depot-list").append("<li><a href=\"javascript:authorS()\">换一批</a></li>");
                        if (callback) {
                            callback(result.data);
                        }
                    } else if (result.code == 500) {
                        alert(result.message)
                    } else if (result.code == 302) {
                        document.location.href = result.data
                    } else {
                        console.log("没有对应code处理:" + result.code);
                    }
                } else {
                    console.log("没有任何返回值");
                }
            }
        })
    }

    function categoryS(hookId) {
        $.ajax({
            url: "/api/category/all/" + hookId,
            beforeSend: function () {

            },
            success: function (result) {
                if (result) {
                    if (result.code == 200) {
                        $("#category-list").empty();
                        result.data.forEach((item) => {
                            let html = "<li onclick='categoryMarkdown(this)' data-id=\"" + item.id + "\"><a href=\"javascript:viod(0)\">" + item.defaultName + "</a></li>"
                            $("#category-list").append(html);
                        })
                    } else if (result.code == 500) {
                        alert(result.message)
                    } else if (result.code == 302) {
                        document.location.href = result.data
                    } else {
                        console.log("没有对应code处理:" + result.code);
                    }
                } else {
                    console.log("没有任何返回值");
                }
            }
        })
    }

    function categoryMarkdown(c, categoryId) {
        if (!categoryId) {
            categoryId = $(c).attr("data-id");
        }
        $.ajax({
            url: "/api/markdown/search/category/" + categoryId,
            beforeSend: function () {

            },
            success: function (result) {
                if (result) {
                    if (result.code == 200) {
                        renderMarkdownList(result.data)
                    } else if (result.code == 500) {
                        alert(result.message)
                    } else if (result.code == 302) {
                        document.location.href = result.data
                    } else {
                        console.log("没有对应code处理:" + result.code);
                    }
                } else {
                    console.log("没有任何返回值");
                }
            }
        })
    }

    function lastPost() {
        $.ajax({
            url: "/api/markdown/top/6",
            beforeSend: function () {

            },
            success: function (result) {
                if (result) {
                    if (result.code == 200) {
                        $("#latest-post").empty()
                        result.data.forEach((item) => {
                            let html = "<li>\n" +
                                "<div class=\"media\">\n" +
                                "<div class=\"media-left\"><a href=\"" + item.showUrl + "\"><img style='    width: 70px;\n" +
                                "    height: 70px;' \n" +
                                "                                                src=\"../images/blog-cover.gif\" alt=\"\"></a></div>\n" +
                                "                                        <div class=\"media-body\"><a href=\"" + item.showUrl + "\">" + item.name + "</a>\n" +
                                "                                            <p>" + item.userName + "</p>\n" +
                                "                                        </div>\n" +
                                "                                    </div>\n" +
                                "                                </li>";
                            $("#latest-post").append(html);
                        })
                    } else if (result.code == 500) {
                        alert(result.message)
                    } else if (result.code == 302) {
                        document.location.href = result.data
                    } else {
                        console.log("没有对应code处理:" + result.code);
                    }
                } else {
                    console.log("没有任何返回值");
                }
            }
        })
    }

    function renderMarkdownList(array) {
        $("#markdown-list").empty();
        array.forEach((item) => {
            let html = "    <li class=\"animate fadeInUp\" data-wow-delay=\"0.4s\">\n" +
                "                                    <div class=\"row\">\n" +
                "                                        <div class=\"col-sm-5\"><img class=\"img-responsive\"\n" +
                "                                                                   src=\"../images/blog-cover.gif\" alt=\"\"></div>\n" +
                "                                        <div class=\"col-sm-7\">\n" +
                "                                            <a href=\"#.\" class=\"tittle-post font-playfair\">\n" +
                item.name +
                "                                            </a>\n" +
                "                                            <!--  Post Info -->\n" +
                "                                            <ul class=\"info\">\n" +
                "                                                <li><i class=\"fa fa-user\"></i>" + item.userName + "</li>\n" +
                "                                                <li><i class=\"fa fa-calendar-o\"></i> " + new Date(item.updateTime).Format("yyyy-MM-dd hh:mm") + "</li>\n" +
                "                                                <li style='cursor: pointer;' onclick='javascript:window.open(\"" + item.githubUrl + "\");'><i class=\"fa fa-link\"></i>原文</li>\n" +
                "                                            </ul>\n" +
                "                                            <a class=\"btn btn-small btn-dark\" href=\"" + item.showUrl + "\">查看</a>\n" +
                "                                            <div class=\"blog-tag-icon\">";
            //1笔记 2 图片 3音屏 4 视频 5 连接
            if (item.typed == 1) {
                html += "<i class=\"fa fa-pencil\"></i>";
            } else if (item.typed == 2) {
                html += " <i class=\"fa fa-picture-o\"></i>";
            } else if (item.typed == 3) {
                html += " <i class=\"fa fa-headphones\"></i>";
            } else if (item.typed == 4) {
                html += " <i class=\"fa fa-film\"></i>";
            } else if (item.typed == 5) {
                html += " <i class=\"fa fa-link\"></i>";
            }
            html += "</div>\n" +
                "                                        </div>\n" +
                "                                </li>\n";
            $("#markdown-list").append(html);
        })
    }

    $(function () {
        authorS(function (data) {
            let item = data[0];
            if (item) {
                id = item.id;
                cutAuthor(item)
                categoryS(item.id)
            }
        });
        lastPost()
        $("#search").click(function () {
            let val = $("#search-text").val();
            if (!val) {
                alert('不能为空');
                return;
            }
            $.ajax({
                url: "/api/markdown/search/name/like",
                data: {
                    name: val
                },
                beforeSend: function () {

                },
                success: function (result) {
                    if (result) {
                        if (result.code == 200) {
                            renderMarkdownList(result.data);
                        } else if (result.code == 500) {
                            alert(result.message)
                        } else if (result.code == 302) {
                            document.location.href = result.data
                        } else {
                            console.log("没有对应code处理:" + result.code);
                        }
                    } else {
                        console.log("没有任何返回值");
                    }
                }
            })
        })
    })

</script>
</body>
</html>